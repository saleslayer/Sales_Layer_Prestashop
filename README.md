


<a href="https://support.saleslayer.com"><img src="https://saleslayer.com/assets/images/logo.svg" alt="Sales Layer WooCommerce" width="460"></a>

# Sales Layer PrestaShop plugin

[![Minimum PHP Version](https://img.shields.io/badge/php-%3E%3D%207.3-8892BF.svg?style=flat-square)](https://php.net/) [![Minimum Prestashop Version](https://img.shields.io/badge/Prestashop-%3E%3D%201.6.1.6-AA92BF.svg?style=flat-square)](https://github.com/PrestaShop/PrestaShop) [![GitHub release](https://img.shields.io/github/v/release/saleslayer/Sales_Layer_Prestashop)](https://github.com/saleslayer/Sales_Layer_Prestashop)

PrestaShop plugin that allows you to easily synchronize your Sales Layer catalogue information with PrestaShop online stores.
[Sales Layer - Global Leading PIM][saleslayer-home]

## Download

[Download latest module version][latest-release-download]
Check out the latest changes at our [Changelog][changelog-md]

## Important notes & documentation
Check the [full module documentation][sc-connector-about] available at our support center.
In some cases, a Sales Layer PIM platform account might be needed to access the documentation.

## Quick Start

#### Upload & Install in your PrestaShop online store the downloaded version of this module as a manual module installation.
* After installed correctly, you will see a new element in your navigation bar named -sales layer-. Go -how to use- menu for further information on module configuration.
> Follow the - How to synchronize by cron - guidelines to enable automatic synchronization.

#### Under channels tab, into your Sales Layer PIM account, create a Prestashop connector and assign the fields.	
* The plugin needs the connector ID code and the private key, you will find them in the connector details inside Sales Layer, after saving your new connector.

#### Add the connector credencials in Prestashop.
* Go to Sales Layer >> Add New Connector. Set the connector id and secret key and press Save Connector.
* Finally, In Sales Layer >> Connectors >> The connector you created. In the Autosync select, choose the frequency of hours in which the synchronization must be performed, in order to synchronize products automatically.
Wait a few minutes and enter the template Sales Layer >> How to use , to verify that we have everything necessary for working.
    
  ![Synchronizing](images/image5.png)
  
## Requirements for synchronization
* cUrl extension installed, In order to call and obtain the information from Sales Layer.
* Active cronjobs.
* Define the fields relationship in the Sales Layer Prestashop connector:
	* Most Prestashop fields are already defined in each section, extra fields for products are converted to features and extra fields for variants are converted to attributes in order to synchronize.
* Inside categories, products and variants there will be attributes; Sales Layer Product Identification, Sales Layer Product Company Identification and Sales Layer Format Identification, don't modify or delete these attributes or its values, otherwise, the products will be created again as new ones in the next synchronization.
* Inside the connector configuration you can set different values before the synchronization in the different tabs, such as:
	* Auto-synchronization and preferred hour for it.
	* The stores where the information will be updated.
	* Overwrite stock status (stock will be updated only at creation of new items)

## Diagnosis and troubleshooting

In the Diagnostics option, we have a tool list available for the diagnostic files generated by our connector.
There are several options when executing in "debug" mode in **Off**. In this mode only files are created if any errors occur and you will only print the debug texts of an item in which an error has occurred.
     
   ![Troubleshooting](images/image1.png) 
     
In other debug options (going up from "level") more information about memory and CPU usage will appear. This information can be used for the development and solution of problems. 
By default, however, the best option is to have it in **Off** mode and thus see only if errors occur so as not to create large files.
The diagnostic files should be deleted automatically after 15 days. The errors that appear in the file will be marked with an icon and in red background. 
The items with error will appear with an informative message and the identifying reference of Sales Layer to be able to go to review the information if it is required. An example of a message would be:
                 
```html          
## Error. Creating category  ID: 91
```

> With this message we know that it is a category and that its reference in Sales Layer is "91".

In case the error does not have an identifying reference it is possible that it has happened somewhere in the middle of the code and, in this case, we can identify it in the general log file that begins with:

```html
_debbug_log_saleslayer_sync_data_
```
... followed with the date of the day of what happened.
 In the file we can find more information about the element in which the problem has occurred (by clicking on the error icon) and we can jump from one error to another and navigate between the errors (if more than one has occurred).
The errors that could be found before the synchronization of an item, most likely relate to this fact. With this we can identify if it is a category or another element, and what concrete reference you have to review it in Sales Layer.

## Development or Customization

For developers who need to customize the plugin or make corrections in the code they can use the diagnostic tool as well as unlock the button to remove everything from prestashop. 
This button will help you to eliminate in bulk all the categories, products and variants to synchronize everything from an empty shop, it is made only for development therefore it should be used in a test server and with caution. To unblock this botton you can edit the saleslayerimport.php file and change the variable value:

```php 
public $i_am_a_developer = false;
```
> set a **true** value to unlock the button.

## Creation of Custom Fields

To create custom fields we can use the **customizable** field in the configuration of the connector in the Sales Layer PIM platform. The module recognizes internal commands that we can add after he value we set as the field name, this appears behind the field { YOUR TEXT FOR FIELD:file }. This Command makes it so that the field is created as a required one, and so the client has to fill in the desired field { YOUR TEXT FOR FIELD:required } . The fields can be created as comma separated text, attribute lists, or completed with a formula such as comma separated text. If we want to send it in several languages we must choose the text field.

### Example:

**My Custom Field:file, My other custom field:required, My field for images:file:required**

this will create fields in prestashop on the product:

* **My Custom Field** - Field to upload images.
* **My other custom field** - Text field with mandatory settings to be filled in by the customer.
* **My field for images** - Field to upload mandatory images to be filled in when sending the order.

## Custom colors

Since version 1.4.3, the module contains a folder called colors, which contains a small database of colors that it recognizes for each language. This folder is used to recognize attributes of non-existent colors in prestashop for variants. This means that if Sales layer comes with a light green variant in Spanish, the plugin will try to find the file es.txt, remove the accents and spaces, and then look for the color light green and assigns it the color value #90ee90 that is predefined in the file. These files can be customized for your needs. The reason for this is that each company uses different names and different color maps in several languages â€‹to recognize colors. This allows you to always have your file and with each update simply copy and paste your colored files into the plugin. It is enough to have a file in a language that we are going to use to recognize colors and assign them the first time the attribute was created.

Another way to send colors is to send the color as text so:

**light green:#90ee90** 

The plugin accepts everything before "**:#**" as a name, "**light green**" and everything after "**:**" as color "**#90ee90**".

## Features

Since PrestaShop Version 1.7 you can send features with more than one value. To separate them you can use the pipe character "*|*" as a separator, in order to create the custom type characteristics you want to include in the command text "**:custom**" either with a formula or in any other way that you find convenient. To create all the features in the same way without having to send a custom command, you can edit the **saleslayerimport.php** file and edit the line:

```php    
public $create_new_features_as_custom = false;
``` 

   and set the value to **true**.

## Version Guidance

| Version | Status | Prestashop version     | Recommended Configuration                |
|---------|--------|------------------------|------------------------------------------|
| 1.5.2   | EOL    | \>= 1.6.1.6, < 1.7.6.x | Prestashop 1.7.6.1 / PHP 7.3 / Apache2.4 |
| 1.5.3   | Stable | \>= 1.6.1.6, < 1.7.8.x | Prestashop 1.7.8.2 / PHP 7.3 / Apache2.4 |
| 2.1.0   | Latest | \>= 8.1.x              | Prestashop 8.1.2 / PHP 8.1  / Apache2.4  |

> **Warning** 
> Prestashop releases frequently new software versions fixing bugs and adding new functionallity. Some of this versions could be in conflict with this plugin. We highly encourage you to set the prestashop configuration recommended in the guidance table for running correctly this plugin.

> **Note** 
> See [System requirements for PrestaShop 8][prestashop8-system-requirements] and [System requirements for PrestaShop 1.7][prestashop1.7-system-requirements] for best setting up on your system environment.

[saleslayer-home]: https://www.saleslayer.com
[latest-release-download]: https://github.com/saleslayer/Sales_Layer_Prestashop/releases/download/2.0.0/prestashop_module_sales_layer_v2.0.0.zip
[changelog-md]: https://github.com/saleslayer/Sales_Layer_Prestashop/blob/master/CHANGELOG.md
[sc-connector-about]: https://support.saleslayer.com/prestashop/important-notes-about-connector
[prestashop8-system-requirements]: https://devdocs.prestashop-project.org/8/basics/installation/system-requirements/
[prestashop1.7-system-requirements]: https://devdocs.prestashop-project.org/1.7/basics/installation/system-requirements/